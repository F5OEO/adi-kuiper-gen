#!/bin/bash
IFACE="$1"
STATE="$2"

CONF="/etc/dhcp/dhcpd.conf"

if [ "$IFACE" = "eth0" ]; then
    if [ "$STATE" = "configured" ]; then
        # DHCP succeeded → remove eth0 subnet from config
        sed -i '/subnet 192.168.8.3/,/}/d' $CONF
    else
        # DHCP failed → add eth0 subnet back if missing
        grep -q "192.168.3.0" $CONF || cat >> $CONF <<EOF
subnet 192.168.3.0 netmask 255.255.255.0 {
  range 192.168.3.10 192.168.3.200;
  option routers 192.168.3.1;
  option domain-name-servers 8.8.8.8, 1.1.1.1;
}
EOF
    fi
    systemctl restart isc-dhcp-server.service
fi
